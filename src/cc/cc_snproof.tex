\section{Proof of Strong Normalization}

Barendregt~1993~\cite{barendregt1993}, Geuvers~1994~\cite{geuvers1994}.





\subsection{Strong Normalization}

\begin{definition}
    The set $\SN$ of \emph{strongly normalizing} terms is defined inductively
    the rule
    $$
        \ruleh{
            \ruleall{b}{a \reduce b}{b \in \SN}
        }
        {
            a \in \SN
        }
    $$
\end{definition}

In words: A term $a$ is strongly normalizing if all its reducts $b$ are strongly
normalizing.

We can view the strongly normalizing terms more intuitively in the following
manner.

\begin{itemize}

    \item A term which is already in normalform i.e. it has no reducts is
        strongly normalizing. In hat case all its reducts (there are none) are
        vacuously strongly normalizing. I.e. terms in normal form form the
        $0$th generation of strongly normalizing terms.

    \item The 2nd generation of strongly normalizing terms are terms which
        reduce only to terms in normal form.

    \item The $(n+1)$th generation of strongly normalizing terms are terms which
        reduce only to terms of the $n$th generation of strongly normalizng
        terms.

    \item $\ldots$

\end{itemize}

This intuitive definition defines the terms which are guaranteed to reduce in
$n$ steps to terms in normal form. The strongly normalizing terms are terms
which are guaranteed to reduce in $n$ steps to terms in normal form for some
natural number $n$.

With this intuitive definition we could prove properties of strongly normalizing
terms by doing induction on the maximal number of steps $n$ needed to reduce to
normal form.


However the formal definition is better suited for doing induction proofs. In
order to prove that some term $a$ which is strongly normalizing has some
property $p(a)$ one can assume that all its reducts have this property. I.e. we
can use an induction scheme similar to rule based induction.

$$
    \begin{array}{l|l}
        \ruleall{b}{a \reduce b}{b \in \SN}
        &
        \ruleall{b}{a \reduce b}{p(b)}
        \\
        \hline
        a \in \SN
        &
        p(a)
    \end{array}
$$

In order to prove the goal $p(a)$ in the lower right corner we can assume all
the other statements especially the induction hypothesis in the upper right
corner.


\begin{theorem}
    \label{StronglyNormalizingRedex}
    \emph{A redex is strongly normalizing if its reduct and all its
    subexpressions are strongly normalizing}.
    $$
    \rulev{
        e \in \SN
        \\
        e[x:=a] \in \SN
        \\
        a \in \SN
        \\
        A \in \SN
    }
    {
        (\lambda x^A.e) a \in SN
    }
    $$

    \begin{proof}
        We do induction on $e \in \SN$, $a \in \SN$ and $A \in \SN$ to get good
        induction hypotheses and then prove the final goal.

        \begin{itemize}
        \item Induction on $e \in \SN$:
            $$
            \begin{array}{l|l}
                \ruleall
                {f}
                {e \reduce f}
                {e \in \SN}
                &
                \ruleall{faA}{
                    e \reduce f
                    \\
                    f[x:=a] \in \SN
                    \\
                    a \in \SN
                    \\
                    A \in \SN
                }
                {(\lambda x^A. f)a \in SN}
                \\
                \hline
                e \in \SN
                &
                \ruleall{aA}{
                    e[x:=a] \in \SN
                    \\
                    a \in \SN
                    \\
                    A \in \SN
                }
                {(\lambda x^A.e) a \in \SN}
            \end{array}
            $$

        \item Assume $e[x:=a] \in \SN$ and do induction on $a \in \SN$:
            $$
            \begin{array}{l|l}
                \ruleall
                {b}
                {a \reduce b}
                {a \in \SN}
                &
                \ruleall{bA}{
                    a \reduce b
                    \\
                    A \in \SN
                }
                {(\lambda x^A. e)b \in SN}
                \\
                \hline
                a \in \SN
                &
                \ruleall{A}{
                    A \in \SN
                }
                {(\lambda x^A.e) a \in \SN}
            \end{array}
            $$

        \item Induction on $A \in \SN$:
            $$
            \begin{array}{l|l}
                \ruleall
                {B}
                {A \reduce B}
                {A \in \SN}
                &
                \ruleall{B}{
                    A \reduce B
                }
                {(\lambda x^B. e)a \in SN}
                \\
                \hline
                A \in \SN
                &
                (\lambda x^A.e) a \in \SN
            \end{array}
            $$

        \item I.e. we have to prove the goal $(\lambda x^A.e)a \in SN$ under the
            following assumptions $e \inÂ \SN$, $e[x:=a] \in \SN$, $a \in \SN$,
            $A \in \SN$ and the following induction hypotheses:
            \begin{enumerate}
            %\item $e \in \SN$
            %\item $e[x:=a] \in \SN$
            %\item $a \in \SN$
            %\item $A \in \SN$
            %\item $\ruleall{f}{e \reduce f}{f \in SN}$
            %\item $\ruleall{b}{a \reduce b}{b \in SN}$
            %\item $\ruleall{B}{A \reduce B}{B \in SN}$

            \item $\ruleall{faA}
                {
                    e \reduce f
                    \\
                    f[x:=a] \in \SN
                    \\
                    a \in \SN
                    \\
                    A \in \SN
                }
                {(\lambda x^A.f)a \in \SN}$

            \item $\ruleall{bA}
                {
                    a \reduce b
                    \\
                    A \in \SN
                }
                {(\lambda x^A.e)b \in \SN}$

            \item $\ruleall{B}
                {
                    A \reduce B
                }
                {(\lambda x^B.e)a \in \SN}$
            \end{enumerate}
        \end{itemize}

        In order to prove the goal $(\lambda x^A.e)a \in SN$ we have to prove
        $$
        \ruleall{c}{(\lambda x^A.e)a \reduce c}{c \in \SN}
        $$

        We assume $(\lambda x^A.e)a \reduce c$. An application can reduce by
        definition of reduction only if the application is a redex (which is the
        case) or if the function term reduces or if the argument reduces. Since
        the function term $\lambda x^A.e$ is an abstraction it reduces either if
        the type of the argument $A$ reduces or the body $e$ reduces. I.e. we 4
        cases to consider:
        \begin{enumerate}
        \item $(\lambda x^A.e)a \reduce e[x:=a]$. Trivial. The goal $e[x:=a]$ is
            valid by assumption 2.

        \item $(\lambda x^A.e)a \reduce (\lambda x^A.f)a$, where $e \reduce f$:
            In that case we have to prove the goal
            $$
                (\lambda x^A.f)a \in \SN
            $$
            by using $e \reduce f$ and the above assumptions. We can use the
                induction hypothesis 1 to prove the goal. The
                only thing missing is a prove of $f[x:=a] \in \SN$. From the
                theorem~\ref{SubstituteReduction} we infer $e[x:=a] \reduce
                f[x:=a]$. Since $e[x:=a] \in \SN$, all its
                reducts must be strongly normalizing by definition of strong
                normalization. This completes the proof for that case.

        \item $(\lambda x^A.e)a \reduce (\lambda x^B.e)a$, where $A \reduce B$:
            In that case we have to prove the goal
            $$
                (\lambda x^B.e)a \in \SN
            $$
            By using $A \reduce B$ and the induction hypothesis 3 we prove the
            goal.

        \item $(\lambda x^A.e)a \reduce (\lambda x^A.e)b$, where $a \reduce
            b$: In that case we have to prove the goal
            $$
                (\lambda x^A.e)b \in \SN
            $$
            By using $a \reduce b$ and the induction hypothesis 2 we prove the
            goal.
        \end{enumerate}
    \end{proof}
\end{theorem}



\subsection{Saturated Sets}

MISSING



\begin{definition}
    \emph{If $A$ and $B$ are sets of lambda terms we define the lambda functions
    space $A \tolambda B$ as the set of lambda terms $f$ such that whenever $a$
    is in $A$ then $fa$ is in $B$}.
    $$
    A \tolambda B := \set{f \mid \forall a. a \in A \imp fa \in B}
    $$
\end{definition}

MISSING

\begin{theorem}
    \label{SaturatedSetsIntersection}
    \emph{The intersection of any collection of saturated sets is a saturated
    set}.
    $$
    \rulev{
        C \subseteq \SAT
    }
    {
        \bigcap C \in \SAT
    }
    $$
    \begin{proof}
        MISSING!!!
    \end{proof}
\end{theorem}





\begin{theorem}
    \label{LambdaSpaceSaturated}
    \emph{The lambda function space between saturated sets is a saturated set}.

    $$
    \rulev{
        A \in \SAT
        \\
        B \in \SAT
    }
    {
        A \tolambda B \in \SAT
    }
    $$
\end{theorem}




\subsection{Model Set}

\begin{definition}
    \emph{Model Set} For $K \in \Kinds$ we define the model set
    $\nu(K)$ by
    $$
        \nu(K) :=
        \left \{
        \begin{array}{llll}
            \nu(s) &:=& \SAT & s \text{ is a sort}
            \\
            \nu(\Pi x^A. B) &:=& \nu(A)\to \nu(B) & A,B \in \Kinds
            \\
            \nu(\Pi x^A. B) &:=& \nu(B) & A \notin \Kinds \land B \in \Kinds
        \end{array}
        \right.
    $$
\end{definition}



\begin{definition}
    \emph{Canonical Model} For $K \in \Kinds$ we define the
    canonical model $\nu^c(K)$ by
    $$
        \nu(K) :=
        \left \{
        \begin{array}{llll}
            \nu^c(s) &:=& \SN & s \text{ is a sort}
            \\
            \nu^c(\Pi x^A. B)
            &:=&
            \bullet \mapsto \nu^c(B) & A,B \in \Kinds
            \\
            \nu^c(\Pi x^A. B)
            &:=&
            \nu^c(B) & A \notin \Kinds \land B \in \Kinds
        \end{array}
        \right.
    $$
    where $\bullet \mapsto v$ is the constant function which maps any argument
    to the value $v$.
\end{definition}


The following property of $\nu$ is convenient:
$$
    \rulev{
        K \in \Kinds
        \\
        \Gamma \vdash F: K
        \\
        \Gamma \vdash F: T
    }
    {
        T \in \Kinds \land \nu(K) = \nu(T)
    }
$$


In order to prove the property we prove first a similar lemma for kinds.

\begin{lemma}
    \label{ModelEquivalentKinds}
    \emph{The model set of a kind is the same as the model set of any beta
    equivalent type}.
    $$
    \rulev{
        K \in \Kinds
        \\
        \Gamma \vdash K: \Any
        \\
        \Gamma \vdash T: s_T
        \\
        K \betaeq T
    }
    {
        T \in \Kinds \land \nu(K) = \nu(T)
    }
    $$

    \begin{proof}
        By induction on the structure of $K$.

        General observation: Since $K$ and $T$ are betaequivalent we get from
        theorem~\ref{TypeUniqueness3} $s_T = \Any$ and
        by~\ref{TypeAnyImpliesKind} that $T$ is a syntactical kind. This is
        valid for all induction hypotheses.

        For the induction proof we distiguish three cases:
        \begin{enumerate}
        \item $K = s$: In that case $K$ has to be $\Prop$, otherwise it would
            not be welltyped.

            Using the general observation above we conclude that
            $T$ is a syntactical kind. $\Prop$ is the only possible syntactical
                kind beta equivalent to $\Prop$. Therefore $T = \Prop$ which
                implies the goal $\nu(T) = \nu(\Prop)$ trivially.

        \item $K = \Pi x^{K_1}. K_2$:
            Since $T$ is a syntactical kind betaequivalent to $K$ it must have
                the form of a product (a sort is not possible). I.e. $T = \Pi
                x^A.B$ for some types $A$ and $B$.

            By theorem~\ref{EquivalentBinders} we get the equivalences $K_1
                \betaeq A$ and $K_2 \betaeq B$.

            From both induction hypotheses we conclude $\nu(K_1) = \nu(A)$ and
            $\nu(K_2) = \nu(B)$.


        \item $K = \Pi x^A . K_2$ (where $A \notin \Kinds$):
            By the same reasoning as above we get $T = \Pi x^{A_T}.B$ for some
            types $A_T$ and $B$ with $A \betaeq A_T$ and $ K_2 \betaeq B$.

                From the induction hypothesis we get $\nu(K_2) = \nu(B)$.

            Since both $A$ and $A_T$ are valid types and $A$ is not a
                syntactical kind, we conclude by using~\ref{TypeUniqueness3}
                that $A_T$ cannot be a syntactical kind either.

            Therefore we get
            $$
                \nu(K) = \nu(K_2) = \nu(B) = \nu(T).
            $$
        \end{enumerate}
    \end{proof}
\end{lemma}


\begin{theorem}
    \label{ModelAllTypesSame}
    \emph{If a type function $F$ is welltyped (i.e. its type is a kind), then
    the model sets of all its possible types are the same}.
    $$
    \rulev{
        K \in \Kinds
        \\
        \Gamma \vdash F: K
        \\
        \Gamma \vdash F: T
    }
    {
        T \in \Kinds \land \nu(K) = \nu(T)
    }
    $$

    \begin{proof}
        From~\ref{TypeUniqueness1} we infer $T \betaeq U$ and
        from~\ref{TypeUniqueness3} we infer that either both are $\Any$ or both
        are types of the same sort.

        If both are $\Any$, then $\nu(K) = \nu(T)$ is valid trivially.

        Assume both are types of the same sort i.e. we have $\Gamma \vdash K: s$
        and $\Gamma \vdash T: s$. Since $K$ is a syntactical kind $s = \Any$ is
        valid.

        Therefore the assumptions of lemma~\ref{ModelEquivalentKinds} are valid
        and we infer the goal by applying the lemma.
    \end{proof}
\end{theorem}



As a next step we prove the fact that the model set of a kind is not affected by
a welltyped substitution.


\begin{theorem}
    \label{ModelSubstitutionSame}
    \emph{A type correct variable substitution does not affect the model set of
    a kind}.
    $$
    \rulev{
        K \in \Kinds
        \\
        \Gamma,x^A \vdash K: \Any
        \\
        \Gamma \vdash a : A
    }
    {
        \nu(K) = \nu(K[x:=a])
    }
    $$
    \begin{proof}

        By induction on $K \in \Kinds$.

        \def\goal#1#2{
            \forall #1.
            \left[
                \rulev{
                    \Gamma,x^A,#1 \vdash #2: \Any
                }
                {
                    \nu(#2) = \nu((#2)[x:=a])
                }
            \right]
        }

        \begin{enumerate}
        \item $s \in \Kinds$: Trivial

        \item
            $$
            \begin{array}{l|l}
                B \notin \Kinds
                \\
                K \in \Kinds
                &
                \goal {\Delta'} K
                \\
                \hline
                \Pi y^B. K \in \Kinds
                &
                \goal \Delta {\Pi y^B. K}
            \end{array}
            $$

            We assume $\Gamma,x^A,\Delta \vdash \Pi y^B.K : \Any$ and derive the
            goal $\nu(\Pi y^B. K) = \nu((\Pi y^B.K)[x:=a])$.

            From the generation lemma~\ref{GenerationLemmata} for products we
            postulate the existence of $s_B$ and $s_K$ such that
            $$
            \begin{array}{lll}
                \Gamma,x^A,\Delta &\vdash& B: s_B
                \\
                \Gamma,x^A,\Delta,y^B &\vdash& K : s_K
                \\
                s_K \betaeq \Any
            \end{array}
            $$
            This implies $s_B = \Prop$ (because $B\notin \Kinds$ and
            corollary~\ref{NotKindImpliesProp}) and $s_K = \Any$.

            Applying the substitution lemma~\ref{SubstitutionLemma} we get
            $$
            \Gamma,x^A,\Delta[x:=a] \vdash B[x:=a] : \Prop
            $$
            which by theorem~\ref{KindImpliesTypeAny} implies $B[x:=a] \notin
            \Kinds$.

            We use $\Delta' = \Delta,y^B$ and derive $\nu(K) = \nu(K[x:=a])$
            from the induction hypothesis.

            Therefore by the equalities
            $$
            \begin{array}{lll}
                \nu(\Pi y^B.K)
                &=& \nu(K)
                \\
                &=& \nu(K[x:=a])
                \\
                &=& \nu(\Pi y^{B[x:=a]}. K[x:=a])
                \\
                &=& \nu((\Pi y^B . K)[x:=a])
            \end{array}
            $$
            we derive the desired goal.

        \item
            $$
            \begin{array}{l|l}
                B \in \Kinds
                &
                \goal \Delta B
                \\
                K \in \Kinds
                &
                \goal {\Delta'} K
                \\
                \hline
                \Pi y^B. K \in \Kinds
                &
                \goal \Delta {\Pi y^B. K}
            \end{array}
            $$
            We assume $\Gamma,x^A,\Delta \vdash \Pi y^B.K : \Any$ and derive the
            goal $\nu(\Pi y^B. K) = \nu((\Pi y^B.K)[x:=a])$.

            From the generation lemma~\ref{GenerationLemmata} for products we
            postulate the existence of $s_B$ and $s_K$ such that
            $$
            \begin{array}{lll}
                \Gamma,x^A,\Delta &\vdash& B: s_B
                \\
                \Gamma,x^A,\Delta,y^B &\vdash& K : s_K
                \\
                s_K \betaeq \Any
            \end{array}
            $$
            This implies $s_B = \Any$ and $s_K = \Any$ because of $B,K \in
            \Kinds$ and therorem~\ref{KindImpliesTypeAny}.

            By using $\Delta' = \Delta,y^B$ the preconditions of both induction
            hypotheses are satisfied and we derive the facts
            $$
            \begin{array}{lll}
                \nu(B) &=& \nu(B[x:=a])
                \\
                \nu(K) &=& \nu(K[x:=a])
            \end{array}
            $$

            Therefore by the equalities
            $$
            \begin{array}{lll}
                \nu(\Pi y^B.K)
                &=& \nu(B) \to \nu(K)
                \\
                &=& \nu(B[x:=a]) \to \nu(K[x:=a])
                \\
                &=& \nu(\Pi y^{B[x:=a]}. K[x:=a])
                \\
                &=& \nu((\Pi y^B . K)[x:=a])
            \end{array}
            $$
            we derive the desired goal.
        \end{enumerate}
    \end{proof}
\end{theorem}





\subsection{Context Interpretation}

\begin{definition}
    \emph{Context Interpretation}:
    We call $\xi = [x_1^{M_1}, x_2^{M_2}, \ldots, x_n^{M_n}]$ an interpretation
    of a context $\Gamma$ if and only if it satisfies the relation $\xi \vDash
    \Gamma$ defined by the rules
    \begin{enumerate}
    \item Empty context
        $$
        []Â \vDash []
        $$
    \item Term variable
        $$
        \rulev{
            \xi \vDash \Gamma
            \\
            \Gamma \vdash A : \Prop
            \\
            x \notin \Gamma
        }
        {
            \xi \vDash \Gamma,x^A
        }
        $$
    \item Type (function) variable
        $$
        \rulev{
            \xi \vDash \Gamma
            \\
            \Gamma \vdash K: \Any
            \\
            F \notin \Gamma
            \\
            M \in \nu(K)
        }
        {
            \xi,F^M \vDash \Gamma,F^K
        }
        $$
    \end{enumerate}
\end{definition}







\subsection{Type Interpretation}

The goal of this section is to find a function which maps any welltyped type
function $F$
for all types $K$ it can have in a certain context $\Gamma$ into a value
$\typeinter{F}{\xi\Gamma} \in \nu (K)$ or $\Any$ into
$\typeinter{\Any}{\xi\Gamma} \in \SAT$. The function is based on a context
interpretation $\xi$ which assigns to each type variable $x$ of type $A$ (which
is a kind) in the context a model which is an element of $\nu(A)$.

\begin{definition}
    \label{SpecificationTypeInterpretation}
    \emph{The type interpretation function $\typeinter{F}{\xi\Gamma}$ must
    satisfy the following specification}.
    $$
    \rulev{
        \xi \vDash \Gamma
        \\
        \Gamma \vdash F : K
        \\
        K \in \Kinds
    }
    {
        \typeinter{F}{\xi\Gamma} \in \nu(K)
    }
    \land
    \ruleh{
        \xi \vDash \Gamma
    }
    {
        \typeinter{\Any}{\xi\Gamma} \in \SAT
    }
    $$

    I.e. it has the preconditions
    \begin{itemize}
    \item The context $\Gamma$ has to be valid and $\xi$ is a context
        interpretation (i.e. $\xi \vdash \Gamma$).

    \item $F$ is either $\Any$ or it is a welltyped type function (i.e. there
        exist some type $K \in \Kinds$ such that $\Gamma \vdash t : K$ is
            valid).
    \end{itemize}

    In the case that $F$ is a welltyped type function, then the
    typeinterpretation has to be an element of $\nu(T)$ for all possible types
    of $F$. If $F$ is $\Any$
    then the typeinterpretation must be a saturated set.
\end{definition}


\begin{definition}
    \label{DefinitionTypeInterpretation}
    \emph{The type interpretation function $\typeinter{F}{\xi\Gamma}$ is defined
    recursively on the structure of $F$}.

    Note that by theorem~\ref{ModelAllTypesSame} we can choose any type of a
    welltyped type function to prove the satisfaction of the specification.

    \begin{enumerate}
    \item Sort:
        $$
        \typeinter{s}{\xi\Gamma} := \SN
        $$
        This definition satisfies the
            specification~\ref{SpecificationTypeInterpretation}. There are two
            cases possible.

            If $s = \Prop$ then it is welltyped and its type is $\Any$ and we
            have $\SN \in \SAT$ and $\SAT = \nu(\Any)$.

            If $s = \Any$ then the specification is trivially satisfied.

    \item Variable:
        $$
        \typeinter{x}{\xi\Gamma} := M
        $$
        where $x^{M} \in \xi$.

        The precondition $\xi \vDash \Gamma$ is possible only if there is a type
        $A$ such that $x^A \in \Gamma$ and $\Gamma \vdash A: \Any$ is valid.
        By the start lemma~\ref{StartLemma} $\Gamma \vdash x : A$ is valid
        and since $\xi$ is a valid context interpretation for the context
        $\Gamma$ we get $M \in \nu(A)$.


    \item Product:
        $$
            \typeinter{\Pi x^A.B}{\xi\Gamma}
            :=
            \typeinter{A}{\xi\Gamma} \tolambda I_B
        $$
        where
            $$
            I_B :=
            \left\{
            \begin{array}{ll}
                \typeinter{B}{\xi(\Gamma,x^A)}
                & \text{if } A \notin \Kinds
                \\
                \bigcap_{M\in\nu(A)}
                \typeinter{B}{(\xi,x^M)(\Gamma,x^A)}
                & \text{if }  A \in \Kinds
            \end{array}
            \right.
        $$

        Since a product is not $\Any$ we have to prove the left part of the
            specification
        $$
        \rulev{
            \xi \vDash \Gamma
            \\
            \Gamma \vdash \Pi x^A.B : K
            \\
            K \in \Kinds
        }
        {
            \typeinter{A}{\xi\Gamma} \tolambda I_B \in \nu(K)
        }
        $$
        where $I_B$ is the type interpretation of $B$ (see above).

        From the generation lemma~\ref{GenerationLemmata} for products we
        postulate the existence of the sorts $s_A$ and $s_B$ such that
        $\Gamma\vdash A: s_A$ and $\Gamma,x^A\vdash B: s_B$ are valid and
        $s_B$ is beta equivalent to $K$.

        Since products cannot be beta equivalent to sorts
        by~\ref{BinderNotEquivalentSortVariable} $K$ must be a sort and the only
        sort beta equivalent to $s_B$ is $s_B$. Therefore we have $K = s_B$ and
        $\nu(K) = \SAT$.

        In order to prove that $\typeinter{A}{\xi\Gamma} \tolambda I_B$ is a
        saturated set by theorem~\ref{LambdaSpaceSaturated} it is sufficient to
        prove that $\typeinter{A}{\xi\Gamma}$ and $I_B$ are saturated sets.
        \begin{enumerate}
        \item $\typeinter{A}{\xi\Gamma} \in \SAT$: The preconditions $\xi \vDash
            \Gamma$, $\Gamma \vdash A : s_A$ and $s_A \in \Kinds$ of the
                typeinterpretation function are satisfied. Therefore we can
                conclude the goal.
        \item $I_B \in \SAT$: We have to distinguish two cases:
            \begin{enumerate}
            \item $A \notin \Kinds$:
                In that case we have $\xi \vDash \Gamma,x^A$ i.e. the
                    preconditions for the typeinterpretation function are
                    satisfied and we get $\typeinter{B}{\xi(\Gamma,x^A)} \in
                    \SAT$.

                \item $A \in \Kinds$: By
                    theorem~\ref{SaturatedSetsIntersection} it is sufficient to
                    prove $\typeinter{B}{(\xi,x^M)(\Gamma,x^A)} \in \SAT$ for
                    all $M \in \nu(A)$.

                    Assume $M \in \nu(A)$. Then $\xi,x^M \vDash \Gamma,x^A$ i.e.
                    the preconditions of the typeinterpretation function are
                    satisfied and we infer the goal.
            \end{enumerate}
        \end{enumerate}

    \item Abstraction:
        $$
        \typeinter{\lambda x^A. e}{\xi\Gamma} :=
            \left\{
            \begin{array}{ll}
                \typeinter{e}{\xi(\Gamma,x^A)}
                & \text{if } A \notin \Kinds
                \\
                M \mapsto \typeinter{e}{(\xi,x^M)(\Gamma,x^A)}
                & \text{if }  A \in \Kinds, M \in \nu(A)
            \end{array}
            \right.
        $$

        Since an abstraction is not $\Any$ we have to prove the left part of the
        specification
        $$
        \rulev{
            \xi \vDash \Gamma
            \\
            \Gamma \vdash \lambda x^A. e : K
            \\
            K \in \Kinds
        }
        {
            \typeinter{\lambda x^A.e}{\xi\Gamma} \in \nu(K)
        }
        $$
        By the generation lemma~\ref{GenerationLemmata} for abstractions we
        postulate the existence of $B$ and $s$ such that $\GammaÂ \vdash \Pi x^A
        . B : s$, $\Gamma,x^A \vdash e : B$ and $K \betaeq \Pi x^A. B$ are
        satisfied.

        By the lemma~\ref{ModelAllTypesSame} we get $\Pi x^A.B \in \Kinds$
        and $\nu(K) = \nu(\Pi x^A. B)$.

        In order to prove the goal $\typeinter{\lambda x^A.e}{\xi\Gamma} \in
        \nu(\Pi x^A.B)$ we distinguish two cases:
        \begin{enumerate}
        \item $A \notin \Kinds$:
            In that case the goal is
            $$
                \typeinter{e}{\xi(\Gamma,x^A)} \in \nu(B)
            $$
            Since $A$ is not a kind we have $\xi \vDash \Gamma,x^A$
            and therefore the preconditions for
            $\typeinter{e}{\xi(\Gamma,x^A)}$ are satisfied and the
            specification of the typeinterpretation function guarantees the
            goal.

        \item $A \in \Kinds$:
            In that case the goal is
            $$
                M \mapsto \typeinter{e}{(\xi,x^M)(\Gamma,x^A)}
                \in \nu(A) \to \nu(B)
            $$
                where $M \in \nu(A)$. The function argument is in the correct
                domain. Because of $\xi,x^M \vDash \Gamma,x^A$ the preconditions
                of $\typeinter{e}{(\xi,x^M)(\Gamma,x^A)}$ are satisfied and the
                specification of the typeinterpretation function guarantees that
                the function maps its argument to a value in the correct range.
        \end{enumerate}

    \item Application:
        $$
        \typeinter{Fa}{\xi\Gamma} :=
        \left\{
        \begin{array}{ll}
            \typeinter{F}{\xi\Gamma}
            &
            \text{if $\Gamma \vdash a : A$ for some $A \notin \Kinds$}
            \\
            \typeinter{F}{\xi\Gamma}(
                \typeinter{a}{\xi\Gamma}
            )
            &
            \text{if $\Gamma \vdash a : A$ for some $A \in \Kinds$}
        \end{array}
        \right.
        $$
        where $\Gamma \vdash a : A$ for some $A$.

        Since an application is not $\Any$ we have to prove the left part of the
        specification
        $$
        \rulev{
            \xi \vDash \Gamma
            \\
            \Gamma \vdash F a: K
            \\
            K \in \Kinds
        }
        {
            \typeinter{F a}{\xi\Gamma} \in \nu(K)
        }
        $$
        \begin{itemize}
        \item
            By the generation lemma~\ref{GenerationLemmata} for applications we
            postulate the existence of $A$ and $B$ such that
            $$
            \begin{array}{l}
                \Gamma \vdash F : \Pi x^A. B
                \\
                \Gamma \vdash a : A
                \\
                K \betaeq B[x:=a]
            \end{array}
            $$
            are valid. By the lemma~\ref{ModelAllTypesSame} we get $B[x:=a] \in
            \Kinds$ and $\nu(K) = \nu(B[x:=a])$ i.e. we have to prove the goal
            $$\typeinter{F a}{\xi\Gamma} \in \nu(B[x:=a])
            $$

        \item
            Using the type of types lemma~\ref{TypeOfTypes} we can derive the
            existence of some sort $s$ such that $\Gamma \vdash \Pi x^A.B :
            s$ is valid. This implies by the generation
            lemma~\ref{GenerationLemmata} for products the existence of the
            sorts $s_A$ and $s_B$ such that
            $\GammaÂ \vdash A : s_A$, $\Gamma,x^A \vdash B : s_B$ and $s \betaeq
            s_B$ are valid (i.e. $s = s_B$). Furthermore by the substitution
            theorem~\ref{SubstitutionLemma} we get $\Gamma \vdash B[x:=a] : s$.

            This implies that $K$ and $B[x:=a]$ are welltyped and therefore
            cannot be $\Any$. Since $K$ is a kind, $s = \Any$ must be valid.

            I.e. we get
            $$
            \begin{array}{lll}
                \Gamma &\vdash& A : s_A
                \\
                \Gamma,x^A &\vdash& B: \Any
                \\
                \Gamma &\vdash& \Pi x^A. B : \Any
            \end{array}
            $$

            Because of theorem~\ref{TypeAnyImpliesKind} we have
            $B \in \Kinds$ and $\Pi x^A . B \in \Kinds$
            i.e. $F$ is a type function.

        \item
            Since $F$ is a type function, the preconditions for the type
                interpretation are satisfied and we get
            $$
                \typeinter{F}{\xi\Gamma} \in \nu(\Pi x^A.B)
            $$


        \item
            We distinguish two cases
            \begin{enumerate}
            \item $A \notin \Kinds$: In that case we have to prove the goal
                $$
                    \typeinter{F}{\xi\Gamma} \in \nu(B[x:=a])
                $$

                We prove the goal by using the equivalence
                $$
                \begin{array}{llll}
                    \nu(B[x:=a]
                    &=& \nu(B)
                    &\text{\ref{ModelSubstitutionSame}}
                    \\
                    &=& \nu(\Pi x^A.B)
                    &\text{definition of $\nu$}
                \end{array}
                $$

            \item $A \in \Kinds$: In that case the  preconditions of the type
                interpretation function for $a$ are satisfied and we get
                $$
                    \typeinter{a}{\xi\Gamma} \in \nu(A)
                $$
                Furthermore we have $\typeinter{F}{\xi\Gamma} \in \nu(A) \to
                    \nu(B)$ and therefore
                    $\typeinter{F}{\xi\Gamma}(\typeinter{a}{\xi\Gamma}$ is a
                    valid function application with
                $$
                    \typeinter{F}{\xi\Gamma}(\typeinter{a}{\xi\Gamma})
                    \in \nu(B)
                $$
                Since typesafe substitution does not change the model we get by
                    using~\ref{ModelSubstitutionSame} $\nu(B) = \nu(B[x:=a])$
                    which proves the goal
                $$
                    \typeinter{F}{\xi\Gamma)}(\typeinter{a}{\xi\Gamma})
                    \in \nu(B[x:=a])
                $$
            \end{enumerate}
        \end{itemize}
    \end{enumerate}
\end{definition}



\begin{theorem}
    \label{TypeInterpretationSubstitution}
    \emph{??}
    $$
    \rulev{
        \xi \vDash \Gamma
        \\
        \Gamma \vdash a: A
        \\
        \Gamma,x^A \vdash F : K
        \\
        K \in \Kinds
    }
    {
        \typeinter{F[x:=a]}{\xi\Gamma}
        =
        \left\{
        \begin{array}{ll}
            \typeinter{F}{\xi(\Gamma,x^A)}
            &
            A \notin \Kinds
            \\
            \typeinter{F}{(\xi,x^{\typeinter{a}{\xi\Gamma}})(\Gamma,x^A)}
            &
            A \in \Kinds
        \end{array}
        \right.
    }
    $$
    \begin{proof}
        \def\tintera{{\typeinter{a}{\xi\Gamma}}}

        We distinguish two cases:
        \begin{itemize}
        \def\subgoal#1#2#3#4{
            \typeinter{(#1)'}{(\xi,#4)(\Gamma,#3')}
            =
            \typeinter{#1}{(\xi,x^\tintera,#4)(\Gamma,x^A,#3)}
        }
        \def\goal#1#2#3#4{
            \ruleall{#2#3#4}
            {
                \Gamma,x^A,#3 \vdash #1 : #2
                \\
                \xi,x^\tintera,\eta \vDash \Gamma,x^A,#3
                \\
                #2 \in \Kinds
            }
            {
                \subgoal {#1} {#2} {#3} {#4}
            }
        }
        \item $A \in \Kinds$: Assume $\xi \vDash \Gamma$ and $\Gamma \vdash a:
            A$ and prove the more general lemma:
            $$
                \goal F K \Delta \eta
            $$
            where $Y'$ is an abbreviation for $Y[x:=a]$. We prove this lemma by
                induction on the structure of $F$.
            \begin{enumerate}
            \item Sort:
                MISSING

            \item Variable:
                MISSING

            \item Product $\Pi y^C.D$:
                We have to prove the goal
                $$
                    \goal {\Pi y^C.D} K \Delta \eta
                $$
                We can use the two induction hypotheses:
                \begin{enumerate}

                \item $\goal C {s_C} \Delta \eta$

                \item $\goal D {s_D} {\Delta_D} {\eta_D}$

                \end{enumerate}

                We prove the goal below the line by assuming all statements
                    above the line and use the equivalence
                $$
                \begin{array}{llll}
                \typeinter{(\Pi y^C.D)'}{(\xi,\eta)(\Gamma,\Delta')}
                &=&
                I_{C'} \tolambda I_{D'}
                \\
                &=&
                I_C \tolambda I_D  &\text{see below}
                \\
                &=&
                \typeinter{\Pi y^C.D}{(\xi,x^\tintera,\eta)(\Gamma,x^A,\Delta)}
                \end{array}
                $$
                where
                $$
                \begin{array}{llll}
                    I_{C'}
                    &=&
                    \typeinter{C'}{(\xi,\eta)(\Gamma,\Delta')}
                    \\
                    I_C
                    &=&
                    \typeinter{C}{(\xi,x^\tintera,\eta)(\Gamma,x^A,\Delta)}
                    \\
                    I_{D'}
                    &=&
                    \bigcap_{N \in \nu(C)}
                        \typeinter
                        {D'}
                        {(\xi,\eta,y^N)(\Gamma,x^A,\Delta,y^{C'})}
                    & C \in \Kinds
                    \\
                    I_D
                    &=&
                    \bigcap_{N \in \nu(C)}
                        \typeinter
                        {D}
                        {(\xi,x^\tintera,\eta,y^N)(\Gamma,x^A,\Delta,y^C)}
                    & C \in \Kinds
                    \\
                    I_{D'}
                    &=&
                    \typeinter{D'}{(\xi,\eta)(\Gamma,\Delta',y^{C'})}
                    & C \notin \Kinds
                    \\
                    I_D
                    &=&
                    \typeinter{D}{(\xi,x^\tintera,\eta)(\Gamma,x^A,\Delta,y^C)}
                    & C \notin \Kinds
                \end{array}
                $$
                We still have to prove $I_{C'} = I_C$ and $I_{D'} = I_D$.

                $I_{C'} = I_C$ follows immediately from the first induction
                hypothesis. In order to prove $I_{D'} = I_D$ we have to
                distinguish two cases:
                \begin{enumerate}
                \item $C \notin \Kinds$: Consequence of the second induction
                    hypothesis by using $\eta_D = \eta$ and $\Delta_D =
                        \Delta,y^C$.

                \item $C \in \Kinds$: Consequence of the second induction
                    hypothesis by using $\eta_D = \eta,y^N$ and $\Delta_D =
                        \Delta,y^C$.
                \end{enumerate}

            \item Abstraction $\lambda y^C. e$:
                MISSING

            \item Application:
                MISSING

            \end{enumerate}

            MISSING

        \item $A \notin \Kinds$:

            MISSING
        \end{itemize}

        We prove the more general theorem (for $A \in \Kinds$):
        $$
        \rulev{
            A,K \in \Kinds
            \\
            \Gamma \vdash a: A
            \\
            \Gamma,x^A,\Delta \vdash F : K
            \\
            \xi,x^{\tintera},\eta \vDash \Gamma,x^A,\Delta
        }
        {
            \typeinter{F[x:=a]}{(\xi,\eta)(\Gamma,\Delta[x:=a])}
            =
            \typeinter{F}{(\xi,x^\tintera,\eta)(\Gamma,x^A,\Delta)}
        }
        $$

        MISSING
    \end{proof}
\end{theorem}



\begin{theorem}
    \label{TypeInterpretationEquivalence}
    \emph{Equivalent type functions have the same type interpretation}
    $$
    \rulev{
        \xi \vDash \Gamma
        \\
        \Gamma \vdash F : K
        \\
        \Gamma \vdash G : s
        \\
        K \in \Kinds
        \\
        F \betaeq G
    }
    {
        \typeinter{F}{\xi\Gamma} = \typeinter{G}{\xi\Gamma}
    }
    $$
    \begin{proof}
        MISSING
    \end{proof}
\end{theorem}




\subsection{Term Interpretation}

$\terminter{t}{\rho}$







\subsection{Context Model}

\begin{definition}
    \label{DefinitionContextModel}
    \emph{Context Model}: We call a term interpretation $\rho$ and a context
    interpretation $\xi$ (i.e. $\xi \vDash \Gamma$) a model of a context which
    we write
    $$
        \rho\xi \vDash \Gamma
    $$
    when
    $\rho$ and $\Gamma$ have the form
    $$
    \begin{array}{lll}
        \Gamma &=& [x_1^{A_1}, \ldots, x_n^{A_n}]
        \\
        \rho   &=& [x_1^{t_1}, \ldots, x_n^{t_n}]
    \end{array}
    $$
    where $t_i \in \typeinter{A_i}{\xi\Gamma}$ for all $i \in \set{1,\ldots,n}$.
\end{definition}




\subsection{Soundness Theorem}

\begin{theorem}
    $$
    \rulev{
        \Gamma \vdash t : T
        \\
        \rho\xi \vDash \Gamma
    }
    {
        \terminter{t}{\rho} \in \typeinter{T}{\xi\Gamma}
    }
    $$
    \def\goal#1#2#3#4#5{
        \forall #1 #2.
        \left[
        \ruleh{
            #1#2 \vDash #3
        }
        {
            \terminter{#4}{#1} \in \typeinter{#5}{#2#3}
        }
        \right]
    }

    \begin{proof}
        By induction on the structure of $t$.

        \begin{enumerate}
        \item Sort:

            MISSING
        \item Variable:

            MISSING
        \item Product:
            $$
            \begin{array}{l|l}
                \Gamma \vdash A : s_A
                &\goal \rho \xi \Gamma A {s_A}
                \\
                \Gamma, x^A \vdash B: s_B
                & \goal {\rho'} {\xi'} {\Gamma,x^A} B {s_B}
                \\
                \hline
                \Gamma \vdash \Pi x^A. B : s_B
                &
                \goal \rho \xi \Gamma {\Pi x^A.B} {s_B}
            \end{array}
            $$

            Assume $\rho\xi \vDash \Gamma$. We have to prove the goal
                $\terminter{\Pi x^A.B}{\rho} \in \SN$ which by definition of the
                terminterpretation is equivalent to the two goals
                $\terminter{A}\rho \in \SN$
                and $\terminter{B}{\rho,x^x} \in SN$.

            From the first induction hypothesis we can prove
            the first subgoal $\terminter{A}{\rho} \in \SN$.

            In order to prove the second subgoal we distinguish two cases:
            \begin{enumerate}
            \item $A \notin \Kinds$:
                We choose $\rho' = \rho,x^x$ and $\xi' = \xi$.
                Since $A$ is not a kind, $\xi' \vDash \Gamma,x^A$ is
                certainly valid. Therefore the second induction hypothesis
                    proves the second subgoal.

            \item $A \in \Kinds$:
                We choose $\rho' = \rho, x^x$ and $\xi' = \xi,x^{\nu^c(A)}$
                    which makes $\rho'\xi' \vDash \Gamma,x^A$ valid. We use the
                    second induction hypothesis to prove the second subgoal.
            \end{enumerate}

        \item Abstraction:
            $$
            \begin{array}{l|l}
                \Gamma \vdash \Pi x^A.B : s
                \\
                \Gamma, x^A \vdash e : B
                &
                \goal {\rho'} {\xi'} {(\Gamma,x^A)} e B
                \\
                \hline
                \Gamma \vdash \lambda x^A.e : \Pi x^A. B
                &
                \goal \rho \xi \Gamma {\lambda x^A.e} {\Pi x^A.B}
            \end{array}
            $$

            Assume $\rho\xi \vDash \Gamma$. We have to prove the goal
            $\terminter{\lambda x^A.e}{\rho} \in [I_A \tolambda I_B]$ where
            $$
            \begin{array}{lll}
                I_A &=& \typeinter{A}{\xi\Gamma}
                \\
                I_B &=&
                \begin{cases}
                    \typeinter{B}{\xi\Gamma}
                    &
                    A \notin \Kinds
                    \\
                    \bigcap_{M \in \nu(A)}
                    \typeinter{B}{(\xi,x^M)(\Gamma,x^A)}
                    &
                    A \in \Kinds
                \end{cases}
            \end{array}
            $$
            Remember that $I_A \tolambda I_B$ is defined as the set of terms
            $\set{f | \forall a. a \in I_A \imp f a \in I_B}$.

            In order to prove the goal we assume $a \in I_A$ and have to prove
            $\terminter{\lambda x^A. e}{\rho} a \in I_B$.

            From the definition of the term interpretation we get the following
            $$
            \begin{array}{lll}
                \terminter{\lambda x^A. e}{\rho} a
                &=&
                (\lambda x^{\terminter{A}{\rho}}. \terminter{e}{\rho,x^x}) a
                \\
                &\keyreduce&
                \terminter{e}{\rho,x^x} [x:=a]
                \\
                &=&
                \terminter{e}{\rho,x^a}
            \end{array}
            $$

            MISSING

        \item Application: We have to prove the goal
            $$
            \terminter{f a}{\rho} \in \typeinter{T}{\xi\Gamma}
            $$
            under the assumptions
            $$
            \begin{array}{lll}
                \Gamma &\vdash& f a : T
                \\
                \rho\xi &\vDash& \Gamma
            \end{array}
            $$
            From the generation lemma~\ref{GenerationLemmata} for applications
            we postulate the existence of the types $A$ and $B$ such that
            $$
            \begin{array}{lll}
                \Gamma &\vdash& f : \Pi x^A.B
                \\
                \Gamma &\vdash& a : A
                \\
                T &\betaeq& B[x:=a]
            \end{array}
            $$

            Furthermore we have the following induction hypotheses available:
            $$
            \begin{array}{lll}
                \terminter{f}{\rho}
                &\in& \typeinter{A}{\xi\Gamma} \tolambda I_B
                \\
                \terminter{a}{\rho} &\in& \typeinter{A}{\xi\Gamma}
            \end{array}
            $$
            where
            $$
            I_B =
            \left\{
            \begin{array}{ll}
                \typeinter{B}{\xi(\Gamma,x^A)}
                & A \notin \Kinds
                \\
                \bigcap_{M \in \nu(A)}
                \typeinter{B}{(\xi,x^M)(\Gamma,x^A)}
            \end{array}
            \right.
            $$

            By using the theorem~\ref{TypeInterpretationSubstitution}, the
            theorem~\ref{TypeInterpretationEquivalence} and $T
            \betaeq B[x:=a]$ we have to prove the goal
            $$
            \terminter{f}{\rho}
            \terminter{a}{\rho}
            \in
            \left\{
                \begin{array}{ll}
                    \typeinter{B}{\xi(\Gamma,x^A)}
                    &
                    A \notin \Kinds
                    \\
                    \typeinter{B}{(\xi,x^M)(\Gamma,x^A)}
                    &
                    A \in \Kinds, M = \typeinter{a}{\xi\Gamma}
                \end{array}
            \right.
            $$
            We distinguish two cases:
            \begin{enumerate}
            \item $A \notin \Kinds$: The goal follows immediately from the
                induction hypotheses and the definition of $\tolambda$.

            \item $A \in \Kinds$: From the induction hypotheses and the
                definition of $\tolambda$ we get
                $$
                    \ruleall{M}{M \in \nu(A)}
                    {
                        \terminter{f}{\rho}
                        \terminter{a}{\rho}
                        \in
                        \typeinter{B}{(\xi,x^M)(\Gamma,x^A)}
                    }
                $$
                and from the specification of the type interpretation we get
                $$
                    \typeinter{a}{\xi\Gamma} \in \nu(A)
                $$
                which finally proves the goal.
            \end{enumerate}
        \end{enumerate}
    \end{proof}
\end{theorem}
