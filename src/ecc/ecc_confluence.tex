\section{Confluence}



\subsection{Parallel Reduction Relation}


\subsubsection{Definition of the Parallel Reduction Relation}

\begin{definition}
    The \emph{parallel reduction relation} $a \preduce b$ is defined inductively
    by the rules
    \begin{enumerate}
    \item Reflexive
    $$
        a \preduce a
    $$

    \item Redex
    $$
        \rulev {
            a \preduce b
            \\
            e \preduce f
        }
        {
            (\lambda x^A. e) a \preduce f[x:=b]
        }
    $$

    \item Product
    $$
    \rulev {
        A \preduce C
        \\
        B \preduce D
    }
    {
        \Pi x^A. B \preduce \Pi x^C. D
    }
    $$

    \item Abstraction
    $$
    \rulev {
        A \preduce B
        \\
        e \preduce f
    }
    {
        \lambda x^A. e \preduce \lambda x^B. f
    }
    $$

    \item Application
    $$
    \rulev {
        a \preduce c
        \\
        b \preduce d
    }
    {
        a b \preduce c d
    }
    $$
    \end{enumerate}
\end{definition}





\subsubsection{Some basic lemmas of the parallel reduction relation}

\begin{lemma}
    \label{ParallelReductionSubstitution1}
    \emph{Basic compatibility of parallel reduction and substitution}
    $$
    \rulev{
        t \preduce u
    }
    {
        a[x:=t] \preduce a[x:=u]
    }
    $$

    \begin{proof}
    By induction on the structure of $a$.
    \begin{enumerate}
    \item $a$ is a sort: Trivial, because substitution does not change a sort
    and reflexivity of the parallel beta reduction.

    \item $a$ is a variable, let's say $y$: In the case $x=y$ the goal is
    implied by the premise. In the case $x \ne y$ the goal is implied by
    reflexivity.

    \item $a$ is the product $\Pi y^B. C$: We have to prove the goal
    $(\Pi y^B. C)[x:=t] \preduce (\Pi y^B.C)[x:=u]$ from the premise $t \preduce
    u$ and the induction hypotheses  $B[x:=t] \preduce B[x:=u]$ and
    $C[x:=t] \preduce C[x:=u]$. The validity of the goal can be seen from the
    following derivation.
    $$
    \begin{array}{lllll}
        (\Pi y^B. C)[x:=t]
        &=& \Pi y^{B[x:=t]}. C[x:=t]
        &\text{definition of substitution}
        \\
        &\preduce& \Pi y^{B[x:=u]}. C[x:=u]
        &\text {induction hypothesis}
        \\
        &=& (\Pi y^B. C)[x:=u]
        &\text{definition of substitution}
    \end{array}
    $$

    \item $a$ is the abstraction $\lambda y^B. e$: Same reasoning as with
    product.

    \item $a$ is the application $f a$: Same reasoning as with
    product.
    \end{enumerate}
    \end{proof}
\end{lemma}


\begin{lemma}
    \label{ParallelReductionSubstitution2}
    \emph{Full compatibility of parallel reduction and substitution}
    $$
    \rulev{
        a \preduce b
        \\
        t \preduce u
    }
    {
        a[x:=t] \preduce b[x:=u]
    }
    $$

    \begin{proof}
        By induction on $a \preduce b$.

        \begin{enumerate}
        \item Reflexive: In that case we have $a = b$. The goal is an immediate
        consequence of lemma~\ref{ParallelReductionSubstitution1}

        \item Redex:
        $$
        \begin{array}{l|l}
            a \preduce b
            & a[x:=t] \preduce b[x:=u]
            \\
            e \preduce f
            & e[x:=t] \preduce f[x:=u]
            \\
            \hline
            (\lambda y^A. e) a \preduce f[y:=b]
            &
            ((\lambda y^A. e) a)[x:=t] \preduce f[y:=b][x:=u]
        \end{array}
        $$

        The validity of the goal in the lower right corner can be seen from the
        following reasoning:
        $$
        \begin{array}{lllll}
            ((\lambda y^A. e) a)[x:=t]
            &=& (\lambda y^{A[x:=t]}. e[x:=t]) a[x:=t]
            &\text{definition of substition}
            \\
            &\preduce& f[x:=u][y:=b[x:=t]]
            &\text{induction hypotheses}
            \\
            &=& f[y:=b][x:=u] &\text{lemma~\ref{DoubleSubstitution}}
        \end{array}
        $$

        \item Product, abstraction and application: Some reasoning as with
        \emph{redex}. The lemma~\ref{DoubleSubstitution} is not needed in these
        cases.
        \end{enumerate}
    \end{proof}


    \begin{lemma}
        \label{ParallelReductionProductAbstraction}
        \emph{The product and abstraction are preserved under parallel
        reduction}

        \begin{enumerate}
        \item
            $\ruleh{\lambda x^A. e \preduce c}
            {\exists B f. c = \lambda x^B. f
                \land A \preduce B \land e \preduce f}$

        \item
            $\ruleh{\Pi x^A. B \preduce c}
            {\exists C D. c = \Pi x^C. D
                \land A \preduce C \land B \preduce D}$
        \end{enumerate}

        \begin{proof} By induction on the premise. In both cases only one rule
        is syntactically possible which guarantees the existence of the
        corresponding terms.
        \end{proof}
    \end{lemma}
\end{lemma}


\subsubsection{Parallel Reduction is a Diamond}


\begin{theorem}
    \label{ParallelReductionDiamond}
    \emph{Parallel reduction is a diamond}
    $$
    \ruleh{
        a \preduce b
    }
    {
        \forall c.
        \left[
        \ruleh{a \preduce c}{\exists d. b \preduce d \land cÂ \preduce d}
        \right]
    }
    $$
\end{theorem}
